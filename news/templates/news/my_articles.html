{% extends 'cyWebsite/base.html' %}
{% block content %}
<div class="container mt-5">
    <h1>Mes articles</h1>
    {% if articles %}
        <div class="row mt-4">
            {% for article in articles %}
            <div class="col-md-4 mb-4 article-card" id="article-card-{{ article.id }}" style="cursor: pointer;">
                <div class="card shadow h-100">
                    <img src="{{ article.cover.url }}" class="card-img-top article-image" alt="Image de couverture" onclick="expandArticle({{ article.id }})">
                    <div class="card-body text-center">
                        <h5 class="card-title" onclick="expandArticle({{ article.id }})">{{ article.title }}</h5>
                        <p class="card-text" onclick="expandArticle({{ article.id }})">{{ article.content|truncatewords:20 }}</p>
                        <small class="text-muted">Publié le {{ article.published_date|date:"d/m/Y H:i" }}</small>
                        <div class="mt-3">
                            <button class="btn btn-danger" onclick="showConfirmation({{ article.id }}, '{{ article.title }}')">Supprimer</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">Vous n'avez pas encore écrit d'articles.</p>
    {% endif %}
</div>

<!-- Expanded Article Modal -->
<div id="expanded-article-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div id="expanded-article" class="card shadow" style="transform: scale(0.8); opacity: 0; transition: transform 0.5s ease, opacity 0.5s ease; width: 80%; max-height: 80vh; overflow-y: auto; background: white; border-radius: 10px; padding: 20px;">
        <button class="btn btn-danger" style="position: absolute; top: 10px; right: 10px;" onclick="closeExpandedArticle()">Fermer</button>
        <div class="card-body text-center">
            <img id="expanded-article-image" src="" class="img-fluid mb-3" alt="Image de couverture">
            <h5 id="expanded-article-title" class="card-title" style="text-decoration: underline; font-size: 2rem;"></h5>
            <p id="expanded-article-content" class="card-text" style="font-size: 1.2rem;"></p>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="delete-confirmation" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="card shadow p-4" style="width: 400px; background: white; border-radius: 10px;">
        <h5 class="text-center">Confirmation de suppression</h5>
        <p class="text-center">Êtes-vous sûr de vouloir supprimer l'article "<strong id="article-title"></strong>" ?</p>
        <form id="delete-form" method="post" action="">
            {% csrf_token %}
            <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-danger">Oui, supprimer</button>
                <button type="button" class="btn btn-secondary" onclick="hideConfirmation()">Annuler</button>
            </div>
        </form>
    </div>
</div>

<script>
    function expandArticle(articleId) {
        const articleCard = document.getElementById(`article-card-${articleId}`);
        const expandedContainer = document.getElementById('expanded-article-container');
        const expandedArticle = document.getElementById('expanded-article');

        // Populate the expanded article content
        const title = articleCard.querySelector('.card-title').innerText;
        const image = articleCard.querySelector('.article-image').src;
        const content = articleCard.querySelector('.card-text').innerText;

        document.getElementById('expanded-article-title').innerText = title;
        document.getElementById('expanded-article-image').src = image;
        document.getElementById('expanded-article-content').innerText = content;

        // Show the expanded article container
        expandedContainer.style.display = 'flex';

        // Trigger animation
        expandedArticle.style.transform = 'scale(1)';
        expandedArticle.style.opacity = '1';
    }

    function closeExpandedArticle() {
        const expandedContainer = document.getElementById('expanded-article-container');
        const expandedArticle = document.getElementById('expanded-article');

        // Reset animation
        expandedArticle.style.transform = 'scale(0.8)';
        expandedArticle.style.opacity = '0';

        // Hide the expanded container after animation
        setTimeout(() => {
            expandedContainer.style.display = 'none';
        }, 500); // Match the duration of the CSS transition
    }

    function showConfirmation(articleId, articleTitle) {
        const modal = document.getElementById('delete-confirmation');
        const titleElement = document.getElementById('article-title');
        const form = document.getElementById('delete-form');

        // Set the article title and form action
        titleElement.textContent = articleTitle;
        form.action = "{% url 'news:delete_article' 0 %}".replace('0', articleId);

        // Show the modal
        modal.style.display = 'flex';
    }

    function hideConfirmation() {
        const modal = document.getElementById('delete-confirmation');
        modal.style.display = 'none';
    }
</script>
{% endblock %}