{% extends 'cyWebsite/base.html' %}
{% block content %}
<h1 class="text-center mt-5">Articles RÃ©cents</h1>
<div class="row mt-4" id="articles-container">
  {% for article in articles %}
  <div class="col-md-4 mb-4 article-card" id="article-card-{{ article.id }}" onclick="expandArticle({{ article.id }})" style="cursor: pointer;">
    <div class="card shadow h-100">
      <img src="{{ article.cover.url }}" class="card-img-top article-image" alt="Image de couverture">
      <div class="card-body text-center">
        <p class="text-muted"><strong>Auteur :</strong> {{ article.author.name }}</p>
        <h5 class="card-title" style="text-decoration: underline; font-size: 1.5rem;">
          {{ article.title }}
        </h5>
        <p id="article-preview-{{ article.id }}" class="card-text" style="font-size: 1rem;">
          {{ article.content|truncatewords:20 }}
        </p>
        <p id="article-full-{{ article.id }}" class="card-text" style="font-size: 1rem; display: none;">
          {{ article.content }}
        </p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div id="expanded-article-container" style="display: none;">
  <div id="blurred-background" class="blurred-background"></div>
  <div id="expanded-article" class="card shadow">
    <button class="btn btn-danger" style="position: absolute; top: 10px; right: 10px;" onclick="closeExpandedArticle()">Fermer</button>
    <div class="card-body text-center" style="overflow-y: auto; max-height: 80vh;">
      <img id="expanded-article-image" src="" class="img-fluid expanded-article-image mb-3" alt="Image de couverture">
      <p id="expanded-article-author" class="text-muted"></p>
      <h5 id="expanded-article-title" class="card-title" style="text-decoration: underline; font-size: 2rem;"></h5>
      <p id="expanded-article-content" class="card-text" style="font-size: 1.2rem;"></p>
    </div>
  </div>
</div>

<script>
  function expandArticle(articleId) {
    const articleCard = document.getElementById(`article-card-${articleId}`);
    const rect = articleCard.getBoundingClientRect(); // Get the position of the article
    const expandedContainer = document.getElementById('expanded-article-container');
    const blurredBackground = document.getElementById('blurred-background');
    const expandedArticle = document.getElementById('expanded-article');

    // Set initial position and size for animation
    expandedContainer.style.display = 'flex';
    expandedContainer.style.position = 'fixed';
    expandedContainer.style.top = '0';
    expandedContainer.style.left = '0';
    expandedContainer.style.width = '100vw';
    expandedContainer.style.height = '100vh';
    expandedContainer.style.justifyContent = 'center';
    expandedContainer.style.alignItems = 'center';

    // Show blurred background
    blurredBackground.style.display = 'block';

    // Populate the expanded article content
    const title = articleCard.querySelector('.card-title').innerText;
    const author = articleCard.querySelector('.text-muted').innerText;
    const image = articleCard.querySelector('.article-image').src;
    const content = document.getElementById(`article-full-${articleId}`).innerText;

    document.getElementById('expanded-article-title').innerText = title;
    document.getElementById('expanded-article-author').innerText = author;
    document.getElementById('expanded-article-image').src = image;
    document.getElementById('expanded-article-content').innerText = content;

    // Animate the expanded article
    expandedArticle.style.transition = 'transform 0.5s ease';
    expandedArticle.style.transform = 'scale(1)';
    expandedArticle.style.width = '80%';
    expandedArticle.style.margin = 'auto';
    expandedArticle.style.backgroundColor = 'white';
    expandedArticle.style.padding = '20px';
    expandedArticle.style.borderRadius = '10px';
  }

  function closeExpandedArticle() {
    const expandedContainer = document.getElementById('expanded-article-container');
    const blurredBackground = document.getElementById('blurred-background');
    const articlesContainer = document.getElementById('articles-container');

    // Reset the expanded container
    expandedContainer.style.display = 'none';

    // Hide blurred background
    blurredBackground.style.display = 'none';

    // Reset the expanded article
    const expandedArticle = document.getElementById('expanded-article');
    expandedArticle.style.transform = 'scale(0.8)';
  }
</script>
{% endblock %}

